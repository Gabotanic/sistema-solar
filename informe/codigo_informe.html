<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de Mantenimiento Fotovoltaico - MANTENSOLAR</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Estilos adicionales para impresión y apariencia */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        body {
            font-family: 'Roboto', sans-serif;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        @page {
            size: A4;
            margin: 0;
        }
        .page-container {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 2rem auto;
            background-color: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .print-hide {
             display: none;
        }
        @media print {
            body {
                margin: 0;
                background-color: white;
            }
            .page-container {
                box-shadow: none;
                margin: 0;
                padding: 15mm;
            }
            .print-hide {
                display: block;
                text-align: center;
                padding: 1rem;
                background-color: #e0f2fe;
                color: #0c5460;
            }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="page-container">
        <!-- Encabezado con Logo -->
        <header class="flex justify-between items-center py-0.5 px-1 bg-blue-900 rounded-t-lg">
            <div>
                <!-- Logo de MANTENSOLAR integrado -->
                <img src="logo_big.png" alt="Logo MANTENSOLAR" class="h-16" style="height: 40px;">
            </div>
            <h2 class="text-base font-semibold text-white" style="font-size: 1rem;">Informe de Mantenimiento</h2>
        </header>

        <main class="mt-8">
            <!-- Sección 1: Datos Generales -->
            <section>
                <h3 class="text-xl font-bold text-blue-900 border-b pb-2 mb-4">1. Datos Generales del Servicio</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm bg-gray-50 p-4 rounded-lg">
                    <div>
                        <p><strong>Cliente:</strong> <span id="cliente-nombre">[Nombre del Cliente]</span></p>
                        <p><strong>Dirección:</strong> <span id="cliente-direccion">[Dirección del Cliente]</span></p>
                        <p><strong>Tipo de Instalación:</strong> Fotovoltaica</p>
                    </div>
                    <div>
                        <p><strong>Fecha de Visita:</strong> <span id="fecha-visita">[Fecha de la visita]</span></p>
                        <p><strong>Técnico Responsable:</strong> MANTENSOLAR</p>
                    </div>
                </div>
            </section>

            <!-- Sección 2: Diagnóstico General -->
            <section class="mt-8">
                <h3 class="text-xl font-bold text-blue-900 border-b pb-2 mb-4">2. Diagnóstico General</h3>
                <div id="diagnostico-general-container" class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                    <!-- Los resultados del diagnóstico se insertarán aquí -->
                </div>
            </section>
            
            <!-- Sección 3: Mediciones Eléctricas -->
            <section class="mt-8">
                <h3 class="text-xl font-bold text-blue-900 border-b pb-2 mb-4">3. Mediciones Eléctricas Clave</h3>
                 <table class="w-full text-sm text-left text-gray-700">
                    <thead class="text-xs text-gray-800 uppercase bg-gray-100">
                        <tr>
                            <th scope="col" class="px-4 py-3 rounded-l-lg">Parámetro</th>
                            <th scope="col" class="px-4 py-3">Antes</th>
                            <th scope="col" class="px-4 py-3">Después</th>
                            <th scope="col" class="px-4 py-3 rounded-r-lg">Diagnóstico</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="px-4 py-3 font-medium">Voltaje (V)</td>
                            <td class="px-4 py-3" id="voltaje-antes">-</td>
                            <td class="px-4 py-3" id="voltaje-despues">-</td>
                            <td class="px-4 py-3 text-green-600 font-semibold" id="voltaje-diagnostico">Óptimo</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-4 py-3 font-medium">Corriente (A)</td>
                            <td class="px-4 py-3" id="corriente-antes">-</td>
                            <td class="px-4 py-3" id="corriente-despues">-</td>
                            <td class="px-4 py-3 text-green-600 font-semibold" id="corriente-diagnostico">Óptimo</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-4 py-3 font-medium">Potencia (W)</td>
                            <td class="px-4 py-3" id="potencia-antes">-</td>
                            <td class="px-4 py-3" id="potencia-despues">-</td>
                            <td class="px-4 py-3 text-green-600 font-semibold" id="potencia-diagnostico">Óptimo</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 font-medium">Resistencia de Aislamiento (MΩ)</td>
                            <td class="px-4 py-3" id="resistencia-aislamiento-antes">-</td>
                            <td class="px-4 py-3" id="resistencia-aislamiento-despues">-</td>
                            <td class="px-4 py-3 text-green-600 font-semibold" id="resistencia-diagnostico">Seguro</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Sección 4: Notas Adicionales -->
            <section class="mt-8">
                <h3 class="text-xl font-bold text-blue-900 border-b pb-2 mb-4">4. Notas Adicionales</h3>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p id="notas-adicionales-texto">No se han añadido notas adicionales.</p>
                </div>
            </section>

             <!-- Sección 5: Registro Fotográfico -->
            <section class="mt-8">
                <h3 class="text-xl font-bold text-blue-900 border-b pb-2 mb-4">5. Registro Fotográfico</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                    <figure>
                        <img id="foto-antes" src="panel_dirty.png" alt="Paneles antes del mantenimiento" class="panel-photo w-full rounded-lg shadow-md border">
                        <figcaption class="mt-2 text-sm font-semibold text-gray-600">ANTES del Mantenimiento</figcaption>
                    </figure>
                    <figure>
                        <img id="foto-despues" src="panel_clean.png" alt="Paneles después del mantenimiento" class="panel-photo w-full rounded-lg shadow-md border">
                        <figcaption class="mt-2 text-sm font-semibold text-gray-600">DESPUÉS del Mantenimiento</figcaption>
                    </figure>
                </div>
            </section>

             <!-- Sección 6: Registro Termográfico -->
            <section class="mt-8">
                <h3 class="text-xl font-bold text-blue-900 border-b pb-2 mb-4">6. Registro Termográfico</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <figure>
                        <img id="termo-paneles" src="https://via.placeholder.com/300x200.png?text=Termografía+Paneles" alt="Termografía de Paneles" class="panel-photo w-full rounded-lg shadow-md border">
                        <figcaption class="mt-2 text-sm font-semibold text-gray-600">Paneles</figcaption>
                    </figure>
                    <figure>
                        <img id="termo-conexiones" src="https://via.placeholder.com/300x200.png?text=Termografía+Conexiones" alt="Termografía de Conexiones" class="panel-photo w-full rounded-lg shadow-md border">
                        <figcaption class="mt-2 text-sm font-semibold text-gray-600">Conexiones</figcaption>
                    </figure>
                    <figure>
                        <img id="termo-inversor" src="https://via.placeholder.com/300x200.png?text=Termografía+Inversor" alt="Termografía de Inversor" class="panel-photo w-full rounded-lg shadow-md border">
                        <figcaption class="mt-2 text-sm font-semibold text-gray-600">Inversor</figcaption>
                    </figure>
                </div>
            </section>
        </main>

        <!-- Pie de página -->
        <footer class="text-center mt-12 pt-6 border-t-2 border-blue-900 text-sm text-gray-600">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
                <div class="text-left">
                    <p class="font-bold">Gracias por confiar en MANTENSOLAR</p>
                    <p>Para consultas: +56 9 1234 5678 | soporte@mantensolar.cl</p>
                </div>
                <div class="flex justify-end items-center">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://mantensolar.cl" alt="Código QR" class="h-20 w-20">
                    <p class="ml-4">Accede a tu historial y<br>beneficios desde la app.</p>
                </div>
            </div>
            <p class="mt-4 text-xs text-gray-400">Informe generado para <span id="codigo-cliente-footer">[Código del Cliente]</span> - Página 1 de 1</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const params = new URLSearchParams(window.location.search);

            // Datos Generales
            document.getElementById('cliente-nombre').textContent = params.get('cliente-nombre') || 'No especificado';
            document.getElementById('cliente-direccion').textContent = params.get('cliente-direccion') || 'No especificada';
            document.getElementById('fecha-visita').textContent = params.get('fecha-visita') || 'No especificada';

            // Diagnóstico General
            const diagnosticoContainer = document.getElementById('diagnostico-general-container');
            const diagnosticoChecks = {
                'Inspección visual de los paneles': params.get('inspeccion-visual') === 'true',
                'Verificación de las conexiones': params.get('verificacion-conexiones') === 'true',
                'Prueba de rendimiento eléctrico': params.get('prueba-rendimiento') === 'true',
                'Estado del inversor': params.get('estado-inversor') === 'true',
                'Cableado y conexiones': params.get('cableado-conexiones') === 'true'
            };
            
            let diagnosticoHTML = '<ul class="list-disc list-inside space-y-2">';
            for(const [key, value] of Object.entries(diagnosticoChecks)) {
                diagnosticoHTML += `<li><strong>${key}:</strong> ${value ? '<span class="text-green-600">OK</span>' : '<span class="text-red-600">Revisar</span>'}</li>`;
            }
            diagnosticoHTML += '</ul>';
            diagnosticoContainer.innerHTML = diagnosticoHTML;

            // Notas Adicionales
            const notas = params.get('notas-adicionales');
            if (notas) {
                document.getElementById('notas-adicionales-texto').textContent = notas;
            }

            // Mediciones Eléctricas
            document.getElementById('voltaje-antes').textContent = params.get('voltaje-antes') || '-';
            document.getElementById('voltaje-despues').textContent = params.get('voltaje-despues') || '-';
            document.getElementById('corriente-antes').textContent = params.get('corriente-antes') || '-';
            document.getElementById('corriente-despues').textContent = params.get('corriente-despues') || '-';
            document.getElementById('potencia-antes').textContent = params.get('potencia-antes') || '-';
            document.getElementById('potencia-despues').textContent = params.get('potencia-despues') || '-';
            document.getElementById('resistencia-aislamiento-antes').textContent = params.get('resistencia-aislamiento-antes') || '-';
            document.getElementById('resistencia-aislamiento-despues').textContent = params.get('resistencia-aislamiento-despues') || '-';

            // Como no podemos pasar las imágenes por URL, se mostrarán placeholders
            // En una app real, se subirían a un servidor y se pasaría la URL.
        });
    </script>
</body>
</html>
